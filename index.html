<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <script src="https://unpkg.com/tone@latest/build/Tone.js"></script>
</head>
<body>

  <button id="play">Play Transient</button>
  <br><br>

  <!-- PITCH INSTABILITY CONTROLS -->
  <h3>Pitch Instability</h3>
  <button id="mutePitch">Mute Pitch</button>
  <input id="volPitch" type="range" min="-40" max="0" value="-10" />

  <br><br>

  <!-- === FREQUENCY ENVELOPE SLIDERS === -->
  Attack <input id="feAttack" type="range" min="0" max="0.01" step="0.0001" value="0.001"><br>
  Decay <input id="feDecay" type="range" min="0" max="0.2" step="0.001" value="0.03"><br>
  Release <input id="feRelease" type="range" min="0" max="0.1" step="0.001" value="0.01"><br>
  BaseFreq <input id="feBase" type="range" min="40" max="500" step="1" value="110"><br>
  Octaves <input id="feOct" type="range" min="0" max="1" step="0.01" value="0.1"><br>

  <script>
    /* -------------------------
       PITCH INSTABILITY NODES
    ------------------------- */
    const pitchOsc = new Tone.Oscillator({
      type: "triangle",
      frequency: 110
    });

    const pitchEnv = new Tone.FrequencyEnvelope({
      attack: 0.001,
      decay: 0.03,
      sustain: 0,
      release: 0.01,
      baseFrequency: 110,
      octaves: 0.1
    });

    pitchEnv.connect(pitchOsc.frequency);
    const pitchVol = new Tone.Volume(-10).toDestination();
    pitchOsc.connect(pitchVol);

    // Mute + Volume
    document.getElementById("mutePitch").onclick = () => {
      pitchVol.mute = !pitchVol.mute;
    };
    document.getElementById("volPitch").oninput = e => {
      pitchVol.volume.value = e.target.value;
    };

    /* -------------------------
       FREQUENCY ENVELOPE SLIDERS
    ------------------------- */

    document.getElementById("feAttack").oninput = e => {
      pitchEnv.attack = parseFloat(e.target.value);
    };

    document.getElementById("feDecay").oninput = e => {
      pitchEnv.decay = parseFloat(e.target.value);
    };

    document.getElementById("feRelease").oninput = e => {
      pitchEnv.release = parseFloat(e.target.value);
    };

    document.getElementById("feBase").oninput = e => {
      pitchEnv.baseFrequency = parseFloat(e.target.value);
    };

    document.getElementById("feOct").oninput = e => {
      pitchEnv.octaves = parseFloat(e.target.value);
    };

    /* -------------------------
       TRIGGER
    ------------------------- */
    document.getElementById("play").onclick = async () => {
      await Tone.start();
      const now = Tone.now();

      pitchOsc.start(now);
      pitchEnv.triggerAttack(now);
      pitchOsc.stop(now + 0.08);
    };
  </script>

</body>
</html>
