<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <script src="https://unpkg.com/tone@latest/build/Tone.js"></script>
</head>
<body>

  <button id="play">Play Transient</button>
  <br><br>

  <!-- PITCH INSTABILITY -->
  <h3>Pitch Instability</h3>
  <button id="mutePitch">Mute Pitch</button>
  <input id="volPitch" type="range" min="-40" max="0" value="-10" />
  <br><br>

  <!-- === FREQUENCY ENVELOPE SLIDERS + READOUTS === -->
  Attack 
  <input id="feAttack" type="range" min="0.001" max="0.5" step="0.001" value="0.001">
  <span id="valAttack">0.001</span><br>

  Decay 
  <input id="feDecay" type="range" min="0.01" max="0.5" step="0.001" value="0.03">
  <span id="valDecay">0.03</span><br>

  Sustain 
  <input id="feSustain" type="range" min="0.0" max="0.5" step="0.001" value="0.0">
  <span id="valSustain">0.0</span><br>

  Release 
  <input id="feRelease" type="range" min="0.00" max="0.5" step="0.001" value="0.01">
  <span id="valRelease">0.01</span><br>

  BaseFreq 
  <input id="feBase" type="range" min="110" max="220" step="1" value="110">
  <span id="valBase">110</span><br>

  Octaves 
  <input id="feOct" type="range" min="0.0" max="1.0" step="0.01" value="0.1">
  <span id="valOct">0.1</span><br><br>

  <script>
    /* ---------------------------------------
       PITCH INSTABILITY NODES
    --------------------------------------- */
    const pitchOsc = new Tone.Oscillator({
      type: "triangle",
      frequency: 110
    });

    const pitchEnv = new Tone.FrequencyEnvelope({
      attack: 0.001,
      decay: 0.03,
      sustain: 0,
      release: 0.01,
      baseFrequency: 110,
      octaves: 0.1
    });

    pitchEnv.connect(pitchOsc.frequency);
    const pitchVol = new Tone.Volume(-10).toDestination();
    pitchOsc.connect(pitchVol);

    /* ---------------------------------------
       MUTE + VOLUME
    --------------------------------------- */
    document.getElementById("mutePitch").onclick = () => {
      pitchVol.mute = !pitchVol.mute;
    };
    document.getElementById("volPitch").oninput = e => {
      pitchVol.volume.value = e.target.value;
    };

    /* ---------------------------------------
       REAL-TIME SLIDER UPDATES + READOUTS
    --------------------------------------- */
    function bindSlider(id, param, readoutId, parser = parseFloat) {
      const slider = document.getElementById(id);
      const label = document.getElementById(readoutId);
      slider.oninput = e => {
        const v = parser(e.target.value);
        pitchEnv[param] = v;
        label.textContent = v;
      };
    }

    bindSlider("feAttack", "attack", "valAttack");
    bindSlider("feDecay", "decay", "valDecay");
    bindSlider("feSustain", "sustain", "valSustain");
    bindSlider("feRelease", "release", "valRelease");
    bindSlider("feBase", "baseFrequency", "valBase", parseFloat);
    bindSlider("feOct", "octaves", "valOct");

    /* ---------------------------------------
       TRIGGER
    --------------------------------------- */
    document.getElementById("play").onclick = async () => {
      await Tone.start();
      const now = Tone.now();
      pitchOsc.start(now);
      pitchEnv.triggerAttack(now);
      pitchOsc.stop(now + 0.2);
    };
  </script>

</body>
</html>
